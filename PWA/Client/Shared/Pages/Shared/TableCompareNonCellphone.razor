@using Bell.Reconciliation.Common.Models
@using Bell.Reconciliation.Frontend.Shared.ServiceInterfaces;
@inject ISyncData SyncData
@inject ILocalDbRepository Localdb

<RadzenButton ButtonStyle="ButtonStyle.Dark" Text="Fetch Data from Server" Click="FetchData"></RadzenButton>
<RadzenButton ButtonStyle="ButtonStyle.Warning" Text="Load data from localDB" Click="LoadFromLocalDB"></RadzenButton>
<br />
NON CELLPHONE
<RadzenTabs  RenderMode="Radzen.TabRenderMode.Client" @bind-SelectedIndex=@selectedIndex>
    <Tabs>
        <RadzenTabsItem Text="Only in Staples">
            <RadzenDataGrid ColumnWidth="150px" AllowFiltering="true" AllowPaging="true" PageSize="8" AllowSorting="true" Data="@staplesSources" TItem="StaplesSourceDto">
                <Columns>
                    <RadzenDataGridColumn TItem="StaplesSourceDto" Property="OrderNumber" Title="OrderNumber" />
                    <RadzenDataGridColumn TItem="StaplesSourceDto" Property="Amount" Title="Amount" />
                    <RadzenDataGridColumn TItem="StaplesSourceDto" Property="Comment" Title="Comment" />
                    <RadzenDataGridColumn TItem="StaplesSourceDto" Property="TransactionDate" Title="TransactionDate" />
                    <RadzenDataGridColumn TItem="StaplesSourceDto" Property="CustomerName" Title="CustomerName" />
                    <RadzenDataGridColumn TItem="StaplesSourceDto" Property="CommissionDetailes" Title="CommissionDetailes" />
                </Columns>
            </RadzenDataGrid>
        </RadzenTabsItem>
        <RadzenTabsItem Text="In both">
            <RadzenDataGrid ColumnWidth="150px" AllowFiltering="true" AllowPaging="true" PageSize="8" AllowSorting="true" Data="@compareBellStaple" TItem="CompareBellStaple">
                <Columns>
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="MatchStatus" Title="STP Consolidate" />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="SOrderNumber" Title="STP Order# Staples" />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="SAmount" Title="STP Amount Staples" />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="SComment" Title="STP Comment Staples" />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="STransactionDate" Title="STP TransactionDate Staples" />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="SCustomerName" Title="STP CustomerName Staples" />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="SCommissionDetailes" Title="STP CommissionDetailes Staples" />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="BOrderNumber" Title="Bell Order# " />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="BAmount" Title="Bell Amount " />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="BComment" Title="Bell Comment " />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="BTransactionDate" Title="Bell TransactionDate " />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="BCustomerName" Title="Bell CustomerName " />
                    <RadzenDataGridColumn TItem="CompareBellStaple" Property="BCommissionDetailes" Title="Bell CommissionDetailes " />
                </Columns>
            </RadzenDataGrid>
        </RadzenTabsItem>
        <RadzenTabsItem Text="Only in Bell">
            <RadzenDataGrid AllowVirtualization="true"  ColumnWidth="150px" AllowFiltering="true" AllowPaging="true" PageSize="8" AllowSorting="true"
                            Data="@bellSources" @ref="grid" TItem="BellSourceDto">
                <Columns>
                    <RadzenDataGridColumn TItem="BellSourceDto" Property="OrderNumber" Title="OrderNumber" />
                    <RadzenDataGridColumn TItem="BellSourceDto" Property="Amount" Title="Amount" />
                    <RadzenDataGridColumn TItem="BellSourceDto" Property="Comment" Title="Comment" />
                    <RadzenDataGridColumn TItem="BellSourceDto" Property="TransactionDate" Title="TransactionDate" />
                    <RadzenDataGridColumn TItem="BellSourceDto" Property="CustomerName" Title="CustomerName" />
                    <RadzenDataGridColumn TItem="BellSourceDto" Property="CommissionDetailes" Title="CommissionDetailes" />
                </Columns>
            </RadzenDataGrid>
        </RadzenTabsItem>
    </Tabs>

</RadzenTabs>

<hr class="featurette-divider">

@code {
    int selectedIndex = 0;

    List<StaplesSourceDto> staplesSources = new();
    List<CompareBellStaple> compareBellStaple = new();
    RadzenDataGrid<BellSourceDto> grid = new RadzenDataGrid<BellSourceDto>();

    private bool busy;
    List<BellSourceDto> bellSources = new();



    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();



        compareBellStaple.AddRange(new List<CompareBellStaple>{
           new CompareBellStaple() { MatchStatus = Common.Models.Enums.MatchStatus.Match, BPhone = "123", SPhone = "123", BAmount = "1", SAmount = "1", BComment = "11", SComment = "11", BCommissionDetails = "32", SCommissionDetails = "32", BCustomerName = "dasd", SCustomerName = "dasd", BIMEI = "2131324", SIMEI = "2131324",  SOrderNumber = "231", BOrderNumber = "231", STransactionDate = "2023-04-04", BTransactionDate = "2023-04-04" },
            new CompareBellStaple() { MatchStatus = Common.Models.Enums.MatchStatus.MissmatchResolved, BPhone = "123", SPhone = "123", BAmount = "1", SAmount = "1", BComment = "11", SComment = "11", BCommissionDetails = "32", SCommissionDetails = "32", BCustomerName = "dasd", SCustomerName = "dasd", BIMEI = "2131324", SIMEI = "2131324",  SOrderNumber = "231", BOrderNumber = "231", STransactionDate = "2023-04-04", BTransactionDate = "2023-04-04" },
            new CompareBellStaple() { MatchStatus = Common.Models.Enums.MatchStatus.MissmatchResolved, BPhone = "123", SPhone = "123", BAmount = "1", SAmount = "1", BComment = "11", SComment = "11", BCommissionDetails = "32", SCommissionDetails = "32", BCustomerName = "dasd", SCustomerName = "dasd", BIMEI = "2131324", SIMEI = "2131324",  SOrderNumber = "231", BOrderNumber = "231", STransactionDate = "2023-04-04", BTransactionDate = "2023-04-04" }
         });
        StateHasChanged();

    }

    private async Task FetchData()
    {
        await SyncData.FetchDataFromServerDb();
        bellSources = await Localdb.GetBellSourceFromLocalDb();

    }

    private async Task LoadFromLocalDB()
    {
        bellSources = await Localdb.GetBellSourceFromLocalDb();
        staplesSources = await Localdb.GetStapleSourceFromLocalDb(); 
    }

    

}
